\documentclass[12pt]{article}
\input{preamble/helper.tex}
\input{00_front-matter/notation.tex}
\input{preamble/draftwatermark.tex}

\title{Algorithm}
\author{Zakariyya Mughal}
\date{2015-12-12}

\begin{document}
\maketitle
\tableofcontents

For the following, all indices are 0-based in order to match the
indexing found in the \gls{orionc} code and reduce the need for
subtracting one when calculating using indices.

\section{Segmentation}

\subsection{Input}

\begin{description}
	\item[\InputVolume{}] is the input volume of dimensions
		\InputVolumeDimensions{} which contains the intensity values taken
		from the microscope modality.
	\item[\RadiiScales{}] is a \Dim{\RadiiScalesName}-vector where each element
		represents the radius of the neurite to segment.
	\item[\LaplacianFilterApproxDegree{}] is the degree of the
		Taylor series used to calculate the approximation
		to the Laplacian filter. This is set to \(60\) based on Paul's
		experiments.

		TODO: show a graph of HDAF at different
\end{description}

\subsection{Extract features}

\subsubsection{Laplacian scale parameter}

\newcommand{\LaplacianScalesName}{\vect{\sigma}^{L}}
\newcommand{\LaplacianScales}{\LaplacianScalesName_{s}}

\(\LaplacianScales\) is a \Dim{\RadiiScalesName}-vector such that
\(
\LaplacianScales = \frac{\RadiiScales{}}{0.66}
\)

TODO explain that 0.66 was chosen by using linear regression and fixing
\(\LaplacianFilterApproxDegree{} = 60\).

\subsubsection{Hessian scale parameter}

\(\vect{\sigma}^{G}_{s}\) is a \Dim{\RadiiScalesName}-vector which is set to
\(\vect{\sigma}^{G}_{s} = \RadiiScales{}\) that is, the radius at which to segment.

\subsubsection{Laplacian filter (HDAF)}

\(\tens{V}^{L}_{s}\InputVolumeIndices\) is a \Dim{\RadiiScalesName}-vector of
\Dim{\InputVolumeName} dimensional volumes where each element
contains the filter response for scale \(\vect{\sigma}^{L}_{s}\).

\subsubsection{Hessian filter}


Hessian filter is defined for a function \(\FuncTo{f}{\Sreal^{n}}{\Sreal}\)
\begin{dmath}
H(V)_{i,j} = \frac{\partial{}^{2}I}{\partial{}e_{i}\partial{}e_{j}}
\end{dmath}
where \(e_{0}, e_{1}, e_{2}\) are the basis vectors for the 3D
coordinate system of the volume \(V\).

\(\lambda_{s,1}\InputVolumeIndices\),
\(\lambda_{s,2}\InputVolumeIndices\), and
\(\lambda_{s,3}\InputVolumeIndices\) are
a collection of \Dim{\RadiiScalesName}-count
\Dim{\InputVolumeName} dimensional volumes where each element is
the respective eigenvalues \(\abs{\lambda_1} \le \abs{\lambda_2} \le \abs{\lambda_3}\) for scale
\(\sigma^{G}_{s}\) (i.e., the eigenvalues are sorted in ascending
order).

\subsubsection{Maximal Laplacian filter response}

\begin{dmath*}
R_{\mathrm{max}}^{L}\InputVolumeIndices = \argmax_{s} \(V^{L}_{s}\InputVolumeIndices\)
\end{dmath*}
where \(R_{\mathrm{max}}^{L}\) is a volume of dimension
\(\Dim{\InputVolumeName}\) where each element is an index such that
all elements satisfy
\(0 \le R_{\mathrm{max}}^{L}\InputVolumeIndices < \Dim{\RadiiScalesName}\)

\subsubsection{Feature vector}


\begin{dmath*}
F^{G}\InputVolumeIndices = \Set{
\left(
\lambda_{r,2}\InputVolumeIndices,
\lambda_{r,3}\InputVolumeIndices
\right)
|
r = R_{\mathrm{max}}^{L}\InputVolumeIndices
}
\end{dmath*}
where \(F^{G}\) is a volume of dimensions \Dim{\InputVolume} with
elements that are each tuples of length two, that is, the number
of eigenvalues used as features.

\subsection{Discriminant function}

\subsubsection{Input}

\begin{description}
	\item[\(F^{G}\)] is a volume that contains the feature vector for each
		voxel in the volume.
	\item[\(H_n\)] is a scalar number of bins.
\end{description}

\subsubsection{Bin bounds and edges}

The 2D histogram minima and maxima are computed for each feature
\begin{dmath*}
	h_{\mathrm{min},q} = \min \Set{ f_q | f_q \in ( f_0, f_1 ) = f \in F^{G} }
\end{dmath*}
\begin{dmath*}
	h_{\mathrm{max},q} = \max \Set{ f_q | f_q \in ( f_0, f_1 ) = f \in F^{G} }
\end{dmath*}

Bin edges are computed for each \(\mnth{q}\) feature
\begin{dmath*}
	b_q[w] =
		h_{\mathrm{min},q} +
		\frac{ h_{\mathrm{max},q}  - h_{\mathrm{min},q}  }
		     { H_n } \, w
\end{dmath*}
where \(w\) is the index of the leading edge to the
\(\mnth{w}\) bin and \( 0 \le w \le  H_n \).

\subsubsection{Histogram accumulation}

\begin{dmath*}
	H[x,y] =  \Dim{ \operatorname{Bin}(F^G, x, y) }
\end{dmath*}
where \(H[x,y]\) is a \(H_n \times H_n\) matrix and
where \(\operatorname{Bin}(F^G, x, y)\) is the set of all tuples
\((f_0, f_1) \in F^G\) such that
\begin{enumerate}
	\item \(b_0[x] \le f_0 < b_0[x+1]\) and
	\item \(b_1[y] \le f_1 < b_1[y+1]\).
\end{enumerate}



\section{Tracing}

\end{document}
