\begin{savequote}[0.55\linewidth]
	\begin{fancyquote}
		The trouble with computers is you \emph{play} with them. They are so
		wonderful. You have these switches --- if it's an even number you do
		this, if it's an odd number you do that --- and pretty soon you can
		do more and more elaborate things if you are clever enough, on one
		machine.
	\end{fancyquote}
	\qauthor{ Richard Feynman in \emph{Surely You're Joking, Mr. Feynman!: Adventures of a Curious Character}, 1985 }
\end{savequote}
\chapter{Design}\label{ch:design}
% 3. Design
%    [ Describes the architectural design, patterns, design
%      decisions. Describe the libraries that are used and
%      why. Documentation system. ]

% FIXME
% explain the importance of the Design phase
Once the planning is done, the actual technical details of the
project are determined in the Design phase. This phase is not a
discrete step that is separate from the following Implementation
phase; as the implementation continues, the Design is updated to
take into account new information. As such, it is important that
the Design be able to incorporate incremental changes otherwise
incorporating new changes will become difficult --- especially
when fundamental data structures need to change. The following
details these design decisions.

\section{MATLAB version of ORION 3}

% FIXME
% start with MATLAB code and why
Since the algorithm already exists as a design in the MATLAB
implementation, this can be leveraged as a starting point for the
conversion. This means that the structure of the native version of
ORION will start off with the same structure as the MATLAB
version. This is to reduce the cognitive load when rewriting and
testing each component because the inputs and outputs remain the
same.

% how the original MATLAB code is used as a starting point
In order to accomplish this, we need an overview of the MATLAB
code. One way to do this is to build a call graph, that is, a
graphical representation of which functions are called by other
functions. Using this, it is possible to trace the execution of
the code. The call graph for the MATLAB code is given in
Appendix~\ref{appx:matlab-call-graph}. By taking this call graph
and creating equivalent functions in the native code, a direct
comparison can be made between the two codebases. Thus, each
function can be converted one-by-one.

\section{Algorithms and architecture}

The architecture of a software system include both the individual
components and how they interact with one another, but the core
data structures that are used to transfer data between the
components. The following description of the architecture will
approach these details from the top-down.

The ORION algorithm consists of three parts (as shown in
Figure~\ref{fig:high-level-arch}), namely
\begin{description}
	\item[Segmentation] to label the
		foreground and the background of the image;
	\item[Registration] for aligning subvolumes so
		that they can be used to create a single volume;
		and
	\item[Tracing] to extract a centreline from the volume to
		capture the underlying neuron morphology.
\end{description}

% TODO add information about the convention used to nodes shapes
\begin{figure}
\centering
\resizebox{1.0\textwidth}{!}{\input{gfx/algorithm/high-level.tex}}
\caption[High level diagram of ORION algorithm]{\textbf{High level
diagram of ORION algorithm}}\label{fig:high-level-arch}
\end{figure}

% TODO explain the current ORION algorithm
\subsection{Segmenation}

\begin{algorithm}
\caption{Fancy algorithm}
\begin{algorithmic}[1]
\If {$i\geq maxval$}
    \State $i\gets 0$
\Else
    \If {$i+k\leq maxval$}
        \State $i\gets i+k$
    \EndIf
\EndIf
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
	\caption{Euclidâ€™s algorithm}\label{euclid}
	\begin{algorithmic}[1]
	\Procedure{Euclid}{$a,b$}\Comment{The g.c.d. of a and b}
		\State $r\gets a\bmod b$
		\While{$r\not=0$}\Comment{We have the answer if r is 0}
			\State $a\gets b$
			\State $b\gets r$
			\State $r\gets a\bmod b$
		\EndWhile\label{euclidendwhile}
		\State \textbf{return} $b$\Comment{The gcd is b}
	\EndProcedure
	\end{algorithmic}
\end{algorithm}

\subsection{Registration}

% FIXME
This step is not a set part of the neuron tracing algorithm. This is mean to handle the subvolume.

\subsection{Tracing}



\section{Anticipating change}

% TODO automatic prerequisite scanning

\subsection{Directory structure}

\begin{description}[font=\tt]
\item[lib]
\item[lib/t]
\item[src]
\end{description}


\subsection{Build system}

% GNU make

\subsubsection{Dependencies}

% - automatic prerequisite scanning

\subsubsection{Configuration}

% - automatic compiler extension configurator (for example, GCC branch prediction __builtin_expect() macro)
% - automatic dependency build flag configuration

\subsubsection{Devops}

%   provides code coverage, debug builds, profiling builds,
%   AddressSanitizer
